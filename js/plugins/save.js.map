/*!
 * froala_editor v3.2.5 (https://www.froala.com/wysiwyg-editor)
 * License https://froala.com/wysiwyg-editor/terms/
 * Copyright 2014-2020 Froala Labs
 */

{"version":3,"file":"save.js","sources":["../../../src/js/plugins/save.js"],"sourcesContent":["import FE from '../index.js'\n'use strict';\n\nObject.assign(FE.DEFAULTS, {\n  saveInterval: 10000,\n  saveURL: null,\n  saveParams: {},\n  saveParam: 'body',\n  saveMethod: 'POST'\n})\n\nFE.PLUGINS.save = function (editor) {\n  const { $ } = editor\n  let _timeout = null\n  let _last_html = null\n  let _force = false\n\n  const BAD_LINK = 1\n  const ERROR_ON_SERVER = 2\n\n  const error_messages = {}\n  error_messages[BAD_LINK] = 'Missing saveURL option.'\n  error_messages[ERROR_ON_SERVER] = 'Something went wrong during save.'\n\n  /**\n   * Throw an image error.\n   */\n  function _throwError(code, response) {\n    editor.events.trigger('save.error', [{\n      code: code,\n      message: error_messages[code]\n    }, response])\n  }\n\n  function save(html) {\n    if (typeof html == 'undefined') html = editor.html.get()\n\n    const original_html = html\n\n    // Trigger before save event.\n    const event_returned_value = editor.events.trigger('save.before', [html])\n\n    if (event_returned_value === false) return false\n    else if (typeof event_returned_value == 'string') html = event_returned_value\n\n    if (editor.opts.saveURL) {\n      const params = {}\n\n      for (const key in editor.opts.saveParams) {\n        if (editor.opts.saveParams.hasOwnProperty(key)) {\n          const param = editor.opts.saveParams[key]\n\n          if (typeof (param) == 'function') {\n            params[key] = param.call(this)\n          }\n          else {\n            params[key] = param\n          }\n        }\n      }\n\n      const dt = {}\n      dt[editor.opts.saveParam] = html\n\n      // Make request to save\n      $(this).ajax({\n        method: editor.opts.saveMethod,\n        url: editor.opts.saveURL,\n        data: Object.assign(dt, params),\n        crossDomain: editor.opts.requestWithCORS,\n        withCredentials: editor.opts.requestWithCredentials,\n        headers: editor.opts.requestHeaders,\n        done: function (data, status, xhr) {\n          _last_html = original_html\n\n          // data\n          editor.events.trigger('save.after', [data])\n        },\n        fail: function (xhr) {\n          // (error)\n          _throwError(ERROR_ON_SERVER, xhr.response || xhr.responseText)\n        }\n      })\n      \n    }\n    else {\n\n      // (error)\n      _throwError(BAD_LINK)\n    }\n  }\n\n  function _mightSave() {\n    clearTimeout(_timeout)\n\n    // Added 0 seconds as to get the timeoutid so that for if there is another request the previous pending request will get cleared out. \n    _timeout = setTimeout(function () {\n      const html = editor.html.get()\n\n      if (_last_html != html || _force) {\n        _last_html = html\n        _force = false\n\n        save(html)\n      }\n    }, 0)\n  }\n\n  /**\n   * Reset the saving interval.\n   */\n  function reset() {\n    _mightSave()\n    _force = false\n  }\n\n  /**\n   * Force saving at the end of the current interval.\n   */\n  function force() {\n    _force = true\n  }\n\n  /*\n   * Initialize.\n   */\n  function _init() {\n    if(editor.opts.letteringClass)\n    {\n      let selectionClass = editor.opts.letteringClass\n      let length = editor.$el.find(`.${selectionClass}`).length\n      for( let i = 0; i < length; i++){\n        editor.$el.find(`.${selectionClass}`)[i].innerHTML = editor.$el.find(`.${selectionClass}`)[i].innerText.replace(/([\\w'-]+|[?.\",])/g, `<span class = 'fr-word-select'>$1</span>`)\n      }\n    }\n    if (editor.opts.saveInterval) {\n      _last_html = editor.html.get()\n      editor.events.on('contentChanged', function () {\n        // Added timeinterval which user has entered else default will be 10000ms. \n        setTimeout(_mightSave, editor.opts.saveInterval)\n      })\n      editor.events.on('keydown destroy', function () {\n        clearTimeout(_timeout)\n      })\n    }\n  }\n\n  return {\n    _init: _init,\n    save: save,\n    reset: reset,\n    force: force\n  }\n}\n\nFE.DefineIcon('save', {\n  NAME: 'floppy-o',\n  FA5NAME: 'save'\n})\nFE.RegisterCommand('save', {\n  title: 'Save',\n  undo: false,\n  focus: false,\n  refreshAfterCallback: false,\n  callback: function () {\n    this.save.save()\n  },\n  plugin: 'save'\n}) \n"],"names":["Object","assign","FE","DEFAULTS","saveInterval","saveURL","saveParams","saveParam","saveMethod","PLUGINS","save","editor","$","_timeout","_last_html","_force","BAD_LINK","ERROR_ON_SERVER","error_messages","_throwError","code","response","events","trigger","message","html","get","original_html","event_returned_value","opts","params","key","hasOwnProperty","param","call","dt","ajax","method","url","data","crossDomain","requestWithCORS","withCredentials","requestWithCredentials","headers","requestHeaders","done","status","xhr","fail","responseText","_mightSave","clearTimeout","setTimeout","reset","force","_init","letteringClass","selectionClass","length","$el","find","i","innerHTML","innerText","replace","on","DefineIcon","NAME","FA5NAME","RegisterCommand","title","undo","focus","refreshAfterCallback","callback","plugin"],"mappings":";;;;;;;;EAGAA,MAAM,CAACC,MAAP,CAAcC,EAAE,CAACC,QAAjB,EAA2B;EACzBC,EAAAA,YAAY,EAAE,KADW;EAEzBC,EAAAA,OAAO,EAAE,IAFgB;EAGzBC,EAAAA,UAAU,EAAE,EAHa;EAIzBC,EAAAA,SAAS,EAAE,MAJc;EAKzBC,EAAAA,UAAU,EAAE;EALa,CAA3B;;EAQAN,EAAE,CAACO,OAAH,CAAWC,IAAX,GAAkB,UAAUC,MAAV,EAAkB;EAAA,MAC1BC,CAD0B,GACpBD,MADoB,CAC1BC,CAD0B;EAElC,MAAIC,QAAQ,GAAG,IAAf;EACA,MAAIC,UAAU,GAAG,IAAjB;EACA,MAAIC,MAAM,GAAG,KAAb;EAEA,MAAMC,QAAQ,GAAG,CAAjB;EACA,MAAMC,eAAe,GAAG,CAAxB;EAEA,MAAMC,cAAc,GAAG,EAAvB;EACAA,EAAAA,cAAc,CAACF,QAAD,CAAd,GAA2B,yBAA3B;EACAE,EAAAA,cAAc,CAACD,eAAD,CAAd,GAAkC,mCAAlC;EAEA;EACF;EACA;;EACE,WAASE,WAAT,CAAqBC,IAArB,EAA2BC,QAA3B,EAAqC;EACnCV,IAAAA,MAAM,CAACW,MAAP,CAAcC,OAAd,CAAsB,YAAtB,EAAoC,CAAC;EACnCH,MAAAA,IAAI,EAAEA,IAD6B;EAEnCI,MAAAA,OAAO,EAAEN,cAAc,CAACE,IAAD;EAFY,KAAD,EAGjCC,QAHiC,CAApC;EAID;;EAED,WAASX,IAAT,CAAce,IAAd,EAAoB;EAClB,QAAI,OAAOA,IAAP,IAAe,WAAnB,EAAgCA,IAAI,GAAGd,MAAM,CAACc,IAAP,CAAYC,GAAZ,EAAP;EAEhC,QAAMC,aAAa,GAAGF,IAAtB,CAHkB;;EAMlB,QAAMG,oBAAoB,GAAGjB,MAAM,CAACW,MAAP,CAAcC,OAAd,CAAsB,aAAtB,EAAqC,CAACE,IAAD,CAArC,CAA7B;EAEA,QAAIG,oBAAoB,KAAK,KAA7B,EAAoC,OAAO,KAAP,CAApC,KACK,IAAI,OAAOA,oBAAP,IAA+B,QAAnC,EAA6CH,IAAI,GAAGG,oBAAP;;EAElD,QAAIjB,MAAM,CAACkB,IAAP,CAAYxB,OAAhB,EAAyB;EACvB,UAAMyB,MAAM,GAAG,EAAf;;EAEA,WAAK,IAAMC,GAAX,IAAkBpB,MAAM,CAACkB,IAAP,CAAYvB,UAA9B,EAA0C;EACxC,YAAIK,MAAM,CAACkB,IAAP,CAAYvB,UAAZ,CAAuB0B,cAAvB,CAAsCD,GAAtC,CAAJ,EAAgD;EAC9C,cAAME,KAAK,GAAGtB,MAAM,CAACkB,IAAP,CAAYvB,UAAZ,CAAuByB,GAAvB,CAAd;;EAEA,cAAI,OAAQE,KAAR,IAAkB,UAAtB,EAAkC;EAChCH,YAAAA,MAAM,CAACC,GAAD,CAAN,GAAcE,KAAK,CAACC,IAAN,CAAW,IAAX,CAAd;EACD,WAFD,MAGK;EACHJ,YAAAA,MAAM,CAACC,GAAD,CAAN,GAAcE,KAAd;EACD;EACF;EACF;;EAED,UAAME,EAAE,GAAG,EAAX;EACAA,MAAAA,EAAE,CAACxB,MAAM,CAACkB,IAAP,CAAYtB,SAAb,CAAF,GAA4BkB,IAA5B,CAjBuB;;EAoBvBb,MAAAA,CAAC,CAAC,IAAD,CAAD,CAAQwB,IAAR,CAAa;EACXC,QAAAA,MAAM,EAAE1B,MAAM,CAACkB,IAAP,CAAYrB,UADT;EAEX8B,QAAAA,GAAG,EAAE3B,MAAM,CAACkB,IAAP,CAAYxB,OAFN;EAGXkC,QAAAA,IAAI,EAAEvC,MAAM,CAACC,MAAP,CAAckC,EAAd,EAAkBL,MAAlB,CAHK;EAIXU,QAAAA,WAAW,EAAE7B,MAAM,CAACkB,IAAP,CAAYY,eAJd;EAKXC,QAAAA,eAAe,EAAE/B,MAAM,CAACkB,IAAP,CAAYc,sBALlB;EAMXC,QAAAA,OAAO,EAAEjC,MAAM,CAACkB,IAAP,CAAYgB,cANV;EAOXC,QAAAA,IAAI,EAAE,cAAUP,IAAV,EAAgBQ,MAAhB,EAAwBC,GAAxB,EAA6B;EACjClC,UAAAA,UAAU,GAAGa,aAAb,CADiC;;EAIjChB,UAAAA,MAAM,CAACW,MAAP,CAAcC,OAAd,CAAsB,YAAtB,EAAoC,CAACgB,IAAD,CAApC;EACD,SAZU;EAaXU,QAAAA,IAAI,EAAE,cAAUD,GAAV,EAAe;EACnB;EACA7B,UAAAA,WAAW,CAACF,eAAD,EAAkB+B,GAAG,CAAC3B,QAAJ,IAAgB2B,GAAG,CAACE,YAAtC,CAAX;EACD;EAhBU,OAAb;EAmBD,KAvCD,MAwCK;EAEH;EACA/B,MAAAA,WAAW,CAACH,QAAD,CAAX;EACD;EACF;;EAED,WAASmC,UAAT,GAAsB;EACpBC,IAAAA,YAAY,CAACvC,QAAD,CAAZ,CADoB;;EAIpBA,IAAAA,QAAQ,GAAGwC,UAAU,CAAC,YAAY;EAChC,UAAM5B,IAAI,GAAGd,MAAM,CAACc,IAAP,CAAYC,GAAZ,EAAb;;EAEA,UAAIZ,UAAU,IAAIW,IAAd,IAAsBV,MAA1B,EAAkC;EAChCD,QAAAA,UAAU,GAAGW,IAAb;EACAV,QAAAA,MAAM,GAAG,KAAT;EAEAL,QAAAA,IAAI,CAACe,IAAD,CAAJ;EACD;EACF,KAToB,EASlB,CATkB,CAArB;EAUD;EAED;EACF;EACA;;;EACE,WAAS6B,KAAT,GAAiB;EACfH,IAAAA,UAAU;;EACVpC,IAAAA,MAAM,GAAG,KAAT;EACD;EAED;EACF;EACA;;;EACE,WAASwC,KAAT,GAAiB;EACfxC,IAAAA,MAAM,GAAG,IAAT;EACD;EAED;EACF;EACA;;;EACE,WAASyC,KAAT,GAAiB;EACf,QAAG7C,MAAM,CAACkB,IAAP,CAAY4B,cAAf,EACA;EACE,UAAIC,cAAc,GAAG/C,MAAM,CAACkB,IAAP,CAAY4B,cAAjC;EACA,UAAIE,MAAM,GAAGhD,MAAM,CAACiD,GAAP,CAAWC,IAAX,YAAoBH,cAApB,GAAsCC,MAAnD;;EACA,WAAK,IAAIG,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGH,MAApB,EAA4BG,CAAC,EAA7B,EAAgC;EAC9BnD,QAAAA,MAAM,CAACiD,GAAP,CAAWC,IAAX,YAAoBH,cAApB,GAAsCI,CAAtC,EAAyCC,SAAzC,GAAqDpD,MAAM,CAACiD,GAAP,CAAWC,IAAX,YAAoBH,cAApB,GAAsCI,CAAtC,EAAyCE,SAAzC,CAAmDC,OAAnD,CAA2D,mBAA3D,6CAArD;EACD;EACF;;EACD,QAAItD,MAAM,CAACkB,IAAP,CAAYzB,YAAhB,EAA8B;EAC5BU,MAAAA,UAAU,GAAGH,MAAM,CAACc,IAAP,CAAYC,GAAZ,EAAb;EACAf,MAAAA,MAAM,CAACW,MAAP,CAAc4C,EAAd,CAAiB,gBAAjB,EAAmC,YAAY;EAC7C;EACAb,QAAAA,UAAU,CAACF,UAAD,EAAaxC,MAAM,CAACkB,IAAP,CAAYzB,YAAzB,CAAV;EACD,OAHD;EAIAO,MAAAA,MAAM,CAACW,MAAP,CAAc4C,EAAd,CAAiB,iBAAjB,EAAoC,YAAY;EAC9Cd,QAAAA,YAAY,CAACvC,QAAD,CAAZ;EACD,OAFD;EAGD;EACF;;EAED,SAAO;EACL2C,IAAAA,KAAK,EAAEA,KADF;EAEL9C,IAAAA,IAAI,EAAEA,IAFD;EAGL4C,IAAAA,KAAK,EAAEA,KAHF;EAILC,IAAAA,KAAK,EAAEA;EAJF,GAAP;EAMD,CA9ID;;EAgJArD,EAAE,CAACiE,UAAH,CAAc,MAAd,EAAsB;EACpBC,EAAAA,IAAI,EAAE,UADc;EAEpBC,EAAAA,OAAO,EAAE;EAFW,CAAtB;EAIAnE,EAAE,CAACoE,eAAH,CAAmB,MAAnB,EAA2B;EACzBC,EAAAA,KAAK,EAAE,MADkB;EAEzBC,EAAAA,IAAI,EAAE,KAFmB;EAGzBC,EAAAA,KAAK,EAAE,KAHkB;EAIzBC,EAAAA,oBAAoB,EAAE,KAJG;EAKzBC,EAAAA,QAAQ,EAAE,oBAAY;EACpB,SAAKjE,IAAL,CAAUA,IAAV;EACD,GAPwB;EAQzBkE,EAAAA,MAAM,EAAE;EARiB,CAA3B;;;;"}